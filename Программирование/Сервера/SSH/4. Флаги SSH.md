### Производительность

Для более быстрой передачи данных можно включить сжатие добавив при подключении флаг -C

`ssh -C user@server`

### **Что такое сжатие в SSH?**

Сжатие в SSH — это механизм, который позволяет уменьшить объем данных, передаваемых по сети, с помощью алгоритмов сжатия. Это может быть полезно, если между клиентом и сервером существует медленное или ограниченное соединение, так как сжатие может снизить задержки и уменьшить время передачи данных.

В SSH сжатие может быть включено через параметр конфигурации, и оно применимо как к передаче данных файлов, так и к интерактивным сессиям.

### **Как работает сжатие в SSH?**

1. **Алгоритм сжатия:**  
    SSH использует алгоритмы сжатия, такие как **Zlib**, для уменьшения объема передаваемых данных. Это сжатие применяется к данным, которые передаются в рамках сеанса SSH, включая:
    
    - Текстовые данные, такие как команды и вывод в интерактивных сессиях.
    - Данные, передаваемые с помощью SCP или SFTP (например, файлы).
2. **Процесс сжатия:**
    
    - Когда клиент устанавливает соединение с сервером, и включено сжатие, SSH сначала сжимает данные перед их отправкой.
    - На стороне сервера данные принимаются, расшифровываются и затем распаковываются.
    - Сжатие применяется только к данным, передаваемым в рамках соединения, то есть к самому каналу передачи данных.
3. **Увеличение производительности при медленных соединениях:**  
    Сжатие может быть полезно на медленных каналах с низкой пропускной способностью, таких как мобильные сети или сети с высокой задержкой, поскольку оно помогает снизить объем передаваемых данных.
    
4. **Оптимизация использования сети:**  
    На каналах с ограниченной пропускной способностью сжатие позволяет уменьшить количество пакетов, необходимых для передачи данных, что может значительно улучшить производительность соединения.
    

---

### **Как включить сжатие в SSH?**

Сжатие в SSH можно включить с помощью конфигурации как на клиенте, так и на сервере.

#### **Включение сжатия на клиенте:**

Для включения сжатия на клиенте нужно использовать параметр `Compression` в конфигурации SSH или указать его в командной строке при подключении:

1. **Через конфигурацию (`~/.ssh/config`):**
    
    Для включения сжатия для определенных хостов можно добавить строку в конфигурационный файл клиента `~/.ssh/config`:
    
    `Host example.com     Compression yes`
    
2. **Через команду в терминале:**
    
    При подключении через SSH можно использовать опцию `-C` для включения сжатия:
       
    `ssh -C user@example.com`
    

#### **Включение сжатия на сервере:**

Для включения сжатия на сервере нужно отредактировать файл конфигурации сервера SSH `sshd_config` и установить параметр `Compression`:

1. Откройте файл конфигурации SSH-сервера:
      
    `sudo nano /etc/ssh/sshd_config`
    
2. Установите параметр `Compression` в `yes`:
    
    `Compression yes`
    
3. Перезапустите SSH-сервер, чтобы изменения вступили в силу:
    
    `sudo systemctl restart sshd`
    

---

### **Параметры сжатия в SSH:**

- **Compression yes**: Включает сжатие. Это значение может быть установлено как на клиенте, так и на сервере.
- **Compression no**: Отключает сжатие (значение по умолчанию в большинстве конфигураций).

### **Преимущества сжатия в SSH:**

1. **Уменьшение объема передаваемых данных:**  
    Сжатие может существенно уменьшить объем данных, особенно если передаются текстовые данные или файлы, которые хорошо сжимаются (например, текстовые файлы, HTML или код).
    
2. **Ускорение работы в условиях медленных соединений:**  
    Сжатие данных помогает ускорить работу на медленных или перегруженных сетевых каналах, поскольку сжимаются только те данные, которые передаются по SSH-соединению, снижая общий объем данных.
    
3. **Снижение времени отклика:**  
    В условиях высокой задержки (например, в мобильных сетях) сжатие может уменьшить время, необходимое для передачи данных, и улучшить отклик системы.
    

---

### **Недостатки сжатия в SSH:**

1. **Увеличение нагрузки на процессор:**  
    Сжатие и распаковка данных требуют ресурсов процессора как на стороне клиента, так и на стороне сервера. На машинах с ограниченными вычислительными мощностями (например, на старых или маломощных устройствах) это может привести к ухудшению производительности.
    
2. **Неэффективность для уже сжатых данных:**  
    Если данные уже сжаты (например, изображения или видео), дополнительное сжатие может не привести к уменьшению объема данных или даже может увеличить их размер.
    
3. **Меньшая выгода при быстром соединении:**  
    На быстрых каналах с большой пропускной способностью сжатие данных может не дать значительного улучшения производительности. В некоторых случаях включение сжатия даже может привести к незначительному ухудшению производительности из-за дополнительной работы процессора.
    

---

### **Итог**

Сжатие в SSH помогает уменьшить объем передаваемых данных, улучшая производительность при медленных или перегруженных соединениях. Это может быть полезно для уменьшения времени отклика и ускорения передачи данных, особенно на текстовых файлах или при работе с ограниченными сетевыми каналами. Однако важно учитывать, что сжатие может добавить дополнительную нагрузку на процессор, и его применение должно быть оправдано в зависимости от ситуации.

### Настройка туннелей и портов

Есть 3 вида туннелирования:

Локальное туннелирования, когда мы обеспечиваем туннель с хоста на удаленную машину

`ssh -L local_port:destination_host:destination_port user@server`

Подключение к базе как пример

`ssh -L 5432:localhost:5432 user@host`

Удаленное туннелирование, когда мы обеспечиваем туннель с удаленной машины на хост

`ssh -R remote_port:local_host:local_port user@server`

Динамическое туннелирования, с использованием протокола SOCKS, когда мы обеспечиваем динамическое использование портов хоста и удаленной машины

`ssh -D 8080 user@server`

### **Что такое SOCKS?**

**SOCKS** (Socket Secure) — это сетевой протокол, который работает на уровне 5 модели OSI (сессия), предназначенный для проксирования сетевых пакетов между клиентом и сервером через промежуточный сервер-прокси. SOCKS позволяет передавать данные между клиентом и сервером, скрывая сам процесс соединения от целевого сервера. Это особенно полезно, когда необходимо скрыть реальный IP-адрес клиента или обойти различные сетевые ограничения.

SOCKS бывает нескольких версий:

- **SOCKS4:** Простая версия, поддерживающая только TCP-трафик, без аутентификации.
- **SOCKS5:** Расширенная версия, поддерживающая как TCP, так и UDP-трафик, а также дополнительные функции, такие как аутентификация и поддержку различных методов подключения.

### **Как работает SOCKS?**

SOCKS-прокси работает следующим образом:

1. Клиент устанавливает соединение с прокси-сервером через SOCKS-протокол.
2. Когда клиент хочет установить соединение с целевым сервером, он отправляет запрос через прокси.
3. Прокси-сервер переправляет запрос на целевой сервер, используя его собственное соединение.
4. Ответ от целевого сервера передается обратно через прокси к клиенту.

SOCKS не изменяет содержимое передаваемых данных — он просто проксирует их. Прокси-сервер может быть настроен для работы с различными приложениями, такими как браузеры, почтовые клиенты и другие.

---

### **Динамическое туннелирование SSH через SOCKS**

**Динамическое туннелирование через SSH** позволяет использовать SSH как механизм для создания SOCKS-прокси-сервера. Это полезно, когда вы хотите передавать весь или определенный трафик через зашифрованный SSH-канал, скрывая ваш реальный IP-адрес и обходя сетевые ограничения.

Динамическое туннелирование через SOCKS обычно используется для создания «динамического SOCKS-прокси», который позволяет приложению (например, браузеру) использовать SSH-соединение как промежуточный сервер. Это делается через параметр `-D` в SSH-команде.

#### **Как работает динамическое туннелирование SSH через SOCKS?**

1. **Установление SSH-соединения с флагом `-D`:**
    
    Когда вы запускаете команду SSH с параметром `-D`, это означает, что вы хотите настроить локальный SOCKS-прокси, который будет использовать SSH-соединение для туннелирования трафика.
    
    Пример команды:
    
    bash
    
    Копировать код
    
    `ssh -D 1080 user@remote_host`
    
    Здесь:
    
    - `-D 1080` — это настройка динамического туннелирования, где `1080` — это порт на локальной машине, который будет использоваться для SOCKS-прокси.
    - `user@remote_host` — это ваше SSH-соединение с удаленным сервером.
    
    После выполнения этой команды ваш компьютер будет слушать на локальном порту `1080` и будет перенаправлять весь трафик, который идет через этот порт, через SSH-соединение к удаленному серверу.
    
2. **Трафик через SOCKS-прокси:**
    
    После установления туннеля любой трафик, направленный на порт `1080`, будет шифроваться через SSH и перенаправляться через сервер, к которому вы подключены. Например, если вы настроите браузер на использование SOCKS-прокси на `localhost:1080`, то весь интернет-трафик, исходящий от браузера, будет передаваться через SSH-туннель, скрывая ваш реальный IP-адрес.
    
3. **Как это работает на практике?**
    
    - Прокси-сервер слушает на локальном порту (например, `localhost:1080`).
    - Когда ваше приложение (например, браузер) подключается к этому порту, оно отправляет запросы через SOCKS-прокси.
    - Прокси-сервер передает запросы через зашифрованный SSH-туннель на удаленный сервер.
    - Удаленный сервер передает запросы в интернет или к целевым серверам.
    - Ответ от целевого сервера возвращается через SSH-туннель, а затем прокси-сервер передает его обратно в приложение.

---

### **Преимущества динамического туннелирования SSH через SOCKS:**

1. **Обход блокировок:**  
    Использование SOCKS-прокси через SSH позволяет обойти блокировки и фильтрацию контента, например, в странах с ограниченным доступом к интернету или на корпоративных сетях.
    
2. **Анонимность:**  
    С помощью динамического туннелирования вы скрываете свой реальный IP-адрес, так как трафик идет через прокси-сервер, который подключен к удаленному серверу.
    
3. **Шифрование:**  
    SSH обеспечивает безопасное шифрование всех данных, передаваемых через туннель, что защищает ваши данные от перехвата или атак типа «человек посередине» (MITM).
    
4. **Гибкость:**  
    Вы можете настроить динамическое туннелирование для различных приложений, просто указывая локальный порт SOCKS-прокси в настройках приложения (например, в браузере или почтовом клиенте).
    

---

### **Пример использования динамического туннелирования SSH через SOCKS**

Предположим, вы хотите использовать SSH для туннелирования трафика вашего браузера. Пример шагов:

1. **Запуск SSH с динамическим туннелированием:**
    
    Запустите SSH-сессию с параметром `-D`:
    
       
    `ssh -D 1080 user@remote_host`
    
    Это создаст локальный SOCKS-прокси на порту 1080.
    
2. **Настройка браузера:**  
    В настройках вашего браузера (например, Firefox или Chrome) укажите SOCKS-прокси:
    
    - **Тип прокси:** SOCKS5
    - **Хост:** `localhost`
    - **Порт:** `1080`
3. **Использование туннеля:**  
    Теперь ваш браузер будет передавать весь трафик через SSH-туннель, проходя через сервер `remote_host`, который скрывает ваш реальный IP-адрес.
    

---

### **Итог**

**Динамическое туннелирование SSH через SOCKS** — это мощный механизм для обхода блокировок, повышения анонимности и защиты данных, который позволяет создавать локальный SOCKS-прокси, перенаправляющий трафик через SSH-туннель. Это помогает скрыть ваш реальный IP-адрес и позволяет безопасно передавать данные через зашифрованные каналы, особенно полезно для использования в странах с цензурой или при работе в небезопасных сетях.

### Базовые флаги

| Флаг                 | Описание                                                                                            | Пример                           |
| -------------------- | --------------------------------------------------------------------------------------------------- | -------------------------------- |
| `-l <username>`      | Указывает имя пользователя для подключения.                                                         | `ssh -l user host`               |
| `-p <port>`          | Указывает порт для подключения. По умолчанию используется `22`.                                     | `ssh -p 2222 user@host`          |
| `-i <identity_file>` | Указывает файл приватного ключа для аутентификации.                                                 | `ssh -i ~/.ssh/id_rsa user@host` |
| `-T`                 | Отключает псевдотерминал. Используется для выполнения команды на удалённом сервере.                 | `ssh -T user@host`               |
| `-q`                 | Режим тишины — отключает все диагностические сообщения.                                             | `ssh -q user@host`               |
| `-v`, `-vv`, `-vvv`  | Включает подробный вывод для отладки. Один флаг `-v` — базовый уровень, `-vv` и `-vvv` — детальнее. | `ssh -vv user@host`              |
| `-C`                 | Включает сжатие данных для ускорения передачи.                                                      | `ssh -C user@host`               |
### Аутентификация

|Флаг|Описание|Пример|
|---|---|---|
|`-o <option>`|Задает параметры подключения в формате ключ=значение (например, ключи или агент).|`ssh -o IdentityFile=~/.ssh/id_rsa user@host`|
|`-A`|Включает перенаправление SSH-агента (используется для передачи аутентификации).|`ssh -A user@host`|
|`-a`|Отключает перенаправление SSH-агента.|`ssh -a user@host`|
|`-K`|Включает аутентификацию Kerberos.|`ssh -K user@host`|
|`-k`|Отключает аутентификацию Kerberos.|`ssh -k user@host`|
### Псевдотерминал и команды

| Флаг | Описание                                                              | Пример                    |
| ---- | --------------------------------------------------------------------- | ------------------------- |
| `-t` | Принудительно включает псевдотерминал (даже если команда передается). | `ssh -t user@host "bash"` |
| `-T` | Отключает псевдотерминал. Используется для выполнения скриптов.       | `ssh -T user@host`        |
### Перенаправление портов

| Флаг                                          | Описание                                           | Пример                               |
| --------------------------------------------- | -------------------------------------------------- | ------------------------------------ |
| `-L <local_port>:<remote_host>:<remote_port>` | Пробрасывает порт с удалённого хоста на локальный. | `ssh -L 8080:localhost:80 user@host` |
| `-R <remote_port>:<local_host>:<local_port>`  | Пробрасывает порт с локального хоста на удалённый. | `ssh -R 8080:localhost:80 user@host` |
| `-D <local_port>`                             | Создает динамический SOCKS-прокси.                 | `ssh -D 1080 user@host`              |
### Конфигурационные файлы

|Флаг|Описание|Пример|
|---|---|---|
|`-F <file>`|Указывает пользовательский конфигурационный файл SSH.|`ssh -F custom_config user@host`|
### Дополнительные параметры

|Флаг|Описание|Пример|
|---|---|---|
|`-N`|Не выполнять команды на сервере. Используется для проброса портов.|`ssh -N -L 8080:localhost:80 user@host`|
|`-f`|Переводит процесс SSH в фоновый режим после подключения.|`ssh -f -N user@host`|
|`-X`|Включает перенаправление X11.|`ssh -X user@host`|
|`-x`|Отключает перенаправление X11.|`ssh -x user@host`|
|`-E <log_file>`|Указывает файл для записи журнала отладки.|`ssh -E debug.log user@host`|
|`-M`|Включает мастер-соединение (контрольный канал для мультиплексирования).|`ssh -M user@host`|
|`-S <control_path>`|Указывает путь к файлу контрольного канала.|`ssh -S /tmp/ssh_mux user@host`|
### Отладка и тестирование

|Флаг|Описание|Пример|
|---|---|---|
|`-v`, `-vv`, `-vvv`|Режим отладки (разные уровни детализации).|`ssh -vv user@host`|
|`-q`|Тихий режим (никаких сообщений).|`ssh -q user@host`|
### Пример полного подключения

`ssh -i ~/.ssh/id_rsa -p 2222 -L 8080:localhost:80 -o Compression=yes user@remote_host`

- Подключение с приватным ключом.
- Использование порта 2222.
- Проброс локального порта 8080 на удалённый 80.
- С включённым сжатием.