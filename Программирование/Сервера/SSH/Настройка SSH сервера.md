### Установка SSH-сервера

`sudo apt install openssh-server sudo systemctl enable ssh sudo systemctl start ssh`

При необходимости можно изменить порт, прописав его в файле конфигурации.

В файле конфигурации `/etc/ssh/sshd_config`:

`Port 2222`

И перезапускаем ssh 

`sudo systemctl restart ssh`

Для ограничения доступа по IP используются файрволл или настройки `/etc/hosts.allow` и `/etc/hosts.deny`.

### Аутентификация

Можно использовать аутентификацию на сервере по ключу, для этого необходимо сгенерировать ключ.

`ssh-keygen -t rsa -b 4096`

**УТОЧНИТЬ МОЖНО ЛИ КРОМЕ RSA ИСПОЛЬЗОВАТЬ ДРУГИЕ КЛЮЧИ**

Сгенерированный ключ можно скопировать на сервер

`ssh-copy-id user@server`

Если необходимо оставить только доступ по ключу, отключив аутентификацию по паролю, то прописываем в настройках `/etc/ssh/sshd_config`:

`PasswordAuthentication no`

При желании можно подключить двухфакторную аутентификацию. Для этого устанавливаем Google Authenticator с помощью команды

`sudo apt install libpam-google-authenticator`

В настройках прописываем 

`ChallengeResponseAuthentication yes`

### Безопасность

Можно повысить безопасность подключения, установив возможность подключаться либо отдельным пользователям, либо группе пользователей

`AllowUsers user1 user2`

`AllowGroups sshusers`

Также можно запретить root доступ, прописав следующую команду 

`PermitRootLogin no`

Можно перевести протокол SSH на вторую версию

`Protocol 2`

**УТОЧНИТЬ ЧЕМ ОТЛИЧАЮТСЯ ВЕРСИИ ПРОТОКОЛА**

Для защиты от брутфорс атаки можно установить и настроить fail2ban. 

**УТОЧНИТЬ ЧТО ЗА ЗАЩИТА И КАК НАСТРАИВАЕТСЯ** 

### Производительность

В настройках конфигурации можно использовать ограничение на время существования подключения и их количество

`ClientAliveInterval 300
`ClientAliveCountMax 0`

**УТОЧНИТЬ КАК ЭТО РАБОТАЕТ**

### Мультиплексирование соединений

`Host *     ControlMaster auto     ControlPath ~/.ssh/sockets/%r@%h:%p     ControlPersist 600`

`mkdir -p ~/.ssh/sockets`

**УТОЧНИТЬ ГДЕ ПРИМЕНЯЕТСЯ ЗА ЧТО ОТВЕЧАЮТ ПАРАМЕТРЫ И КАК ЭТО РАБОТАЕТ**

### Логирование и мониторинг

В файле настроек прописываем следующую команду

`LogLevel VERBOSE`

**УТОЧНИТЬ КАК ИЗМЕНЯЕТСЯ ЛОГИРОВАНИЕ ПРИ ИЗМЕНЕНИИ УРОВНЯ**

### Использование SSH-агента

Добавление ключей в SSH-агент
`eval "$(ssh-agent -s)" ssh-add ~/.ssh/id_rsa`

Перенаправление агента на удалённый сервер, прописывается в настройках
`ForwardAgent yes`

**УТОЧНИТЬ ЧТО ЭТО И ДЛЯ ЧЕГО ИСПОЛЬЗУЕТСЯ**

### Настройка SSH для пользователей

Ограничение команд для пользователя настраивается через файл `.ssh/authorized_keys`:
`command="ls -l" ssh-rsa AAAAB...`

chroot

**УТОЧНИТЬ ЧТО ЭТО И ДЛЯ ЧЕГО ИСПОЛЬЗУЕТСЯ**

### Масштабирование

Настройка `ssh_config` для нескольких серверов в файле `~/.ssh/config`:

`Host server1     HostName 192.168.1.1     User user1     Port 2222`

**УТОЧНИТЬ КАК ЭТО РАБОТАЕТ**