NGINX автоматически читает все конфигурационные файлы в каталоге conf.d. Поэтому необходимо следить за тем, чтобы конфигурации не пересекались между собой. 
Создадим группу серверов в отдельном файле
`vi /etc/nginx/conf.d/upstreams.conf`

И укажем в нем 3 адреса

```Nginx
upstream my_backend { 
    server 192.168.10.10; 
    server 192.168.10.11;  
    server 192.168.10.12;  
}
```

Укажем в настройках nginx проксирование по созданной нами конфигурации:

```Nginx
server {  
    location / {  
        proxy_pass http://my_backend; 
    }  
}
```

Указанная настройка будет переводить абсолютно все запросы на указанные в конфигурационном файле веб-сервера. По умолчанию все сервера имеют равный приоритет равный единице, но с помощью ключевого слова weight мы можем указать частоту обращения на конкретный веб-сервер. 

Перепишем конфигурацию, добавив веса и состояния для некоторых адресов: 

```Nginx
upstream my_backend {  
    server 192.168.10.10 weight=100;  
    server 192.168.10.11 weight=10;  
    server 192.168.10.12;  
    server 192.168.10.13 backup;  
    server 192.168.10.14 down;
}
```

Данная конфигурация определяет частоту запросов на веб-сервера, из 111 запросов - 100 будет обработано 10-м сервером, 10 - 11-м, и 1 обращение упадет на 12 сервер. 

Кроме того есть ключевые слова состояния сервера `backup` - так обозначается сервер, который будет использоваться в случае, если все другие сервера окажутся недоступными, и `down` - так обозначается сервер, которые считается недоступным на постоянной основе, например, если данный сервер находится в обслуживании или на нем ведутся другие работы, которые приостанавливают его работу. 

По умолчанию балансировка работает по алгоритму `round-robin`, но мы можем указать в группе серверов другой алгоритм, при необходимости. 

- Round Robin - запросы распределяются по серверам по очереди. Этот метод равномерно распределяет нагрузку между всеми серверами.
- Least Connections - Запрос направляется на сервер с наименьшим количеством активных соединений. Используется для того, чтобы разгружать серверы, на которых в данный момент больше всего активных запросов. Команда - `least_conn;`
- IP Hash - метод привязывает клиента к конкретному серверу на основе его IP-адреса. Это полезно, если важно, чтобы запросы от одного и того же клиента всегда шли на один и тот же сервер (например, для сохранения сессий). Команда - `ip_hash;`
- По весу сервера - Можно указать "вес" для каждого сервера, чтобы более мощные сервера получали больше запросов. Команда добавляется после указания адреса сервера- `weight=3;`

Также в группе серверов можно подключиться пассивную проверку сервера, которая будет временно отключать его, если несколько запросов подряд не удалось выполнить.

```Nginx
upstream backend_servers {
    server backend1.example.com;
    server backend2.example.com;
    server backend3.example.com;

    # если сервер не отвечает на 3 запроса подряд, он временно не используется
    server backend1.example.com max_fails=3 fail_timeout=30s;
}
```






