У Nginx есть встроенные механизмы, которые можно использовать для защиты от DDoS-атак. Однако он не является специализированным инструментом для предотвращения DDoS и в основном обеспечивает базовую защиту от перегрузки. Для более продвинутой защиты рекомендуется использовать внешние решения (например, Cloudflare, AWS Shield или специализированные firewall-устройства).

Тем не менее, Nginx можно настроить для противодействия некоторым видам атак. Вот основные методы защиты:

---

### **1. Ограничение скорости запросов (Rate Limiting)**

Можно ограничить количество запросов от одного IP-адреса за определённый период времени.

#### Пример конфигурации:

nginx

Копировать код

`http {     limit_req_zone $binary_remote_addr zone=one:10m rate=10r/s;      server {         location / {             limit_req zone=one burst=20 nodelay;             proxy_pass http://backend;         }     } }`

- **`rate=10r/s`**: Ограничение до 10 запросов в секунду.
- **`burst=20`**: Допускает до 20 "взрывных" запросов перед включением ограничения.
- **`nodelay`**: Отправляет лишние запросы сразу с ошибкой, вместо задержки.

---

### **2. Ограничение соединений (Connection Limiting)**

Ограничивает количество одновременных соединений от одного IP-адреса.

#### Пример конфигурации:

nginx

Копировать код

`http {     limit_conn_zone $binary_remote_addr zone=addr:10m;      server {         location / {             limit_conn addr 10;             proxy_pass http://backend;         }     } }`

- **`addr`**: Зона памяти для хранения данных.
- **`limit_conn addr 10`**: Разрешает не более 10 одновременных соединений с одного IP.

---

### **3. Ограничение размера тела запросов**

Можно запретить загрузку слишком больших файлов или тел запросов, что помогает противодействовать атакам через гигантские POST-запросы.

#### Пример:

nginx

Копировать код

`server {     client_max_body_size 1m; # Ограничение на 1 МБ }`

---

### **4. Блокировка вредоносных IP-адресов**

Можно вручную заблокировать известные IP-адреса атакующих.

#### Пример:

nginx

Копировать код

`server {     deny 192.168.1.1;     deny 10.0.0.0/8;     allow all; }`

---

### **5. Использование правил фильтрации (User-Agent, Referer)**

Можно фильтровать вредоносные запросы по заголовкам.

#### Пример:

nginx

Копировать код

`server {     location / {         if ($http_user_agent ~* (bot|crawler|spider)) {             return 403;         }     } }`

---

### **6. Включение кэша**

Кэширование помогает снизить нагрузку на backend-серверы, так как запросы от злоумышленников будут обрабатываться быстрее.

#### Пример:

nginx

Копировать код

`proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m max_size=1g;  server {     location / {         proxy_cache my_cache;         proxy_pass http://backend;     } }`

---

### **7. Увеличение лимитов ресурсов Nginx**

В случае высоких нагрузок стоит настроить оптимальные параметры ресурсов:

nginx

Копировать код

`worker_processes auto; worker_connections 4096; # Количество соединений на процесс`

---

### **8. Использование капчи**

Хотя Nginx не поддерживает капчу напрямую, можно настроить редирект на страницу с капчей или интегрировать внешние решения, такие как Google reCAPTCHA, через дополнительные механизмы.

---

### **9. Использование ModSecurity**

ModSecurity — это модуль веб-приложений (WAF), который может быть интегрирован с Nginx. Он позволяет создавать сложные правила для фильтрации запросов.

#### Установка ModSecurity для Nginx:

bash

Копировать код

`sudo apt install libnginx-mod-security`

Пример правила:

nginx

Копировать код

`server {     modsecurity on;     modsecurity_rules_file /etc/nginx/modsec/main.conf; }`

---

### **10. Защита через внешние решения**

- **Cloudflare**: Бесплатное или платное использование облачного WAF и защиты от DDoS.
- **AWS Shield**: Интеграция с инфраструктурой AWS для защиты от атак.
- **Dedicated Firewall**: Аппаратные или программные решения (например, Fortinet, Imperva).

---

### Итог:

Nginx может предоставить базовую защиту от DDoS-атак, но для масштабных атак (например, ботнетов) его возможностей может быть недостаточно. В таких случаях лучше использовать Nginx в сочетании с внешними инструментами защиты.