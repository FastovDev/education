Чтобы настроить Nginx для раздачи статических файлов нужно указать, где хранится эта статика, и настроить правильные пути в конфигурации. Nginx особенно эффективен для этой задачи благодаря высокой производительности при работе со статическими файлами, асинхронной обработке и оптимизации большого количества соединений.

Для раздачи статических файлов они все должны храниться в определенном каталоге на сервере. В примере будем использовать папку `/var/www/html`.

В конфигурации сервера мы прописываем путь к этой папке с параметром root. Данный параметр указывает серверу, что по указанному пути будут располагаться файлы статики и будет искать их в этой папке. 

Также мы можем указать файлы, которые будут открываться по умолчанию при переходу по какому-либо пути мы будем стараться искать файлы с указанным именем. В примере это `index index.html index.htm;`

Следующий участок кода 
```
location / {
	try_files $uri $uri/ =404;
}
```
говорит о том, что любой путь на сервере, если не находит никаких файлов, связанных с нашей конфигурацией, то будет возвращать страницу с ошибкой 404. 

Команда `include /etc/nginx/mime.types;` указывает путь к файлу, в котором будут перечислены различные mime-types файлов. 

Следующие команды 
```
access_log /var/log/nginx/access.log;
error_log /var/log/nginx/error.log;
```

Общий файл настройки конфигурации с указанными выше командами: 

```
server {
    listen 80;
    server_name example.com;

    # Директория, где хранятся статические файлы
    root /var/www/html;

    # Файлы, которые будут открываться по умолчанию
    index index.html index.htm;

    # Обработка запросов
    location / {
        try_files $uri $uri/ =404;
    }

    # Установка типов MIME для файлов
    include /etc/nginx/mime.types;

    # Логи (необязательно)
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;
}
```

Пример более сложной конфигурации:
Если нужно обслуживать статику только из определенной папки (например, `/assets`), можно настроить секцию `location` для этой задачи, перенаправляя все остальные запросы, которые не соответствуют пути assets в другой `location`. 

```
server {
    listen 80;
    server_name example.com;

    # Раздача статики из папки /assets
    location /assets/ {
        root /var/www/static;
        try_files $uri $uri/ =404;
    }

    # Остальные запросы направляем на другое приложение, например, на сервер приложений
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```




Настройка кэширования для статики:
Для улучшения производительности можно настроить кэширование статических файлов на стороне клиента:

server {
    listen 80;
    server_name example.com;

    root /var/www/html;
    index index.html index.htm;

    location / {
        try_files $uri $uri/ =404;
    }

    # Кэширование статики
    location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
        expires 30d;
        add_header Cache-Control "public, no-transform";
    }
}
Разбор:
*location ~ .(jpg|jpeg|png|gif|ico|css|js)$**: Регулярное выражение для обработки запросов к файлам с расширениями, такими как .jpg, .png, .css, .js.
expires 30d;: Устанавливает срок действия кэша для этих файлов на 30 дней.
add_header Cache-Control "public, no-transform";: Добавляет заголовок Cache-Control, чтобы указать браузерам и прокси-серверам, что файл можно кэшировать.
Вывод
Определите директорию для статических файлов и укажите её в конфигурации Nginx.
Настройте секцию location, чтобы обрабатывать запросы к файлам.
Для улучшения производительности можно добавить кэширование статики.

Чтобы настроить сжатие статических файлов в Nginx, используется модуль gzip, который позволяет сжимать HTTP-ответы (например, HTML, CSS, JavaScript) перед отправкой их клиенту. Это значительно уменьшает объем передаваемых данных и улучшает производительность, особенно для клиентов с медленным интернетом.

Шаги для настройки сжатия в Nginx:
Убедитесь, что модуль gzip включен. По умолчанию он встроен в Nginx.
Настройте параметры сжатия в конфигурационном файле.
Пример базовой конфигурации для сжатия:

http {
    gzip on;                       # Включаем gzip-сжатие
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    gzip_min_length 256;            # Минимальный размер файла для сжатия (в байтах)
    gzip_comp_level 5;              # Степень сжатия (от 1 до 9)
    gzip_vary on;                   # Добавляет заголовок Vary: Accept-Encoding
    gzip_proxied any;               # Включает сжатие для ответов от проксированных серверов
}
Описание параметров:
gzip on;: Включает поддержку сжатия gzip.
gzip_types: Определяет типы файлов, которые будут сжаты. По умолчанию Nginx сжимает только text/html. В примере добавлены типы файлов для сжатия, такие как CSS, JavaScript, JSON и XML.
gzip_min_length 256;: Указывает минимальный размер файла, который будет сжат. Файлы меньше 256 байт не будут сжиматься.
gzip_comp_level 5;: Устанавливает уровень сжатия. Значение может быть от 1 до 9. Чем выше значение, тем лучше сжатие, но тем больше нагрузка на процессор.
gzip_vary on;: Добавляет заголовок Vary: Accept-Encoding в ответ, что указывает кэширующим прокси и браузерам использовать кэш для разных типов сжатия (gzip или без сжатия).
gzip_proxied any;: Разрешает сжатие для всех ответов, которые проходят через прокси-серверы. Вы можете уточнить это значение, например, сжимать только ответы с кодом 200.
Сжатие только для конкретных типов файлов:
Если вы хотите сжимать только определённые типы файлов, можно настроить секции location для этих файлов:

server {
    listen 80;
    server_name example.com;

    root /var/www/html;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    # Включение сжатия только для JavaScript, CSS и HTML
    location ~* \.(html|css|js)$ {
        gzip on;
        gzip_types text/plain text/css application/javascript;
        gzip_min_length 256;
        gzip_comp_level 6;
        gzip_vary on;
    }
}
Дополнительные параметры сжатия:
gzip_buffers: Определяет количество и размер буферов, которые Nginx использует для хранения сжатых данных перед их отправкой клиенту. Например:

gzip_buffers 16 8k;
Это означает, что будет создано 16 буферов по 8 KB каждый.

gzip_disable: Используется для отключения gzip для конкретных пользовательских агентов (браузеров). Например:

gzip_disable "MSIE [1-6]\.(?!.*SV1)";
Это отключит gzip для старых версий Internet Explorer (до IE6).

gzip_http_version: Задает минимальную версию HTTP-протокола для использования gzip. Обычно сжатие применяется для HTTP/1.1, но его можно разрешить и для HTTP/1.0:

gzip_http_version 1.0;
Проверка сжатия:
Чтобы убедиться, что Nginx правильно сжимает файлы, можно использовать инструменты для проверки заголовков HTTP, такие как:

Веб-браузер (вкладка "Сеть" в инструментах разработчика).
curl с флагом -I:
bash

curl -I -H "Accept-Encoding: gzip" http://example.com/file.css
В ответе должен быть заголовок:
http

Content-Encoding: gzip
Заключение:
Включение gzip сжатия в Nginx улучшает производительность за счет уменьшения размера передаваемых данных.
Настройка параметров, таких как gzip_types, gzip_comp_level, и минимальный размер файла, позволяет гибко управлять тем, какие данные будут сжаты и с какой степенью.
Дополнительные параметры позволяют настраивать исключения для старых браузеров или контролировать использование буферов для сжатых данных.
