Dapper — это легковесная микрофреймворк-библиотека для работы с базой данных в .NET, которая часто используется как альтернатива Entity Framework Core (EF Core) для сценариев, когда требуется максимальная скорость выполнения запросов и минимальное количество накладных расходов.

---

## Основные особенности Dapper

- **Легковесность:**  
    Dapper — это по сути набор расширений для интерфейса `IDbConnection`, который не требует сложной конфигурации и не реализует полноценное отслеживание изменений или миграций. Это позволяет получать высокую производительность при выполнении запросов.
    
- **Производительность:**  
    Благодаря минимальной абстракции и работе непосредственно с SQL-запросами, Dapper показывает отличные результаты по скорости работы, особенно в сценариях с большим количеством запросов.
    
- **Простота использования:**  
    Работа с Dapper сводится к написанию SQL-запросов и вызову методов расширения (`Query`, `QueryFirstOrDefault`, `Execute` и т.д.), что позволяет разработчику иметь полный контроль над запросами.
    
- **Маппинг результатов:**  
    Dapper автоматически отображает результаты запросов в объекты Plain Old CLR Objects (POCO), что упрощает работу с данными без необходимости дополнительной конфигурации.
    

---

## Пример использования Dapper

### Пример 1: Получение списка пользователей

```C#
using System.Data;
using System.Data.SqlClient;
using Dapper;
using System.Collections.Generic;

// Пример модели
public class User
{
    public int Id { get; set; }
    public string Name { get; set; }
}

// Метод для получения списка пользователей
public IEnumerable<User> GetUsers()
{
    using (IDbConnection db = new SqlConnection("Server=(localdb)\\mssqllocaldb;Database=MyDb;Trusted_Connection=True;"))
    {
        string sqlQuery = "SELECT Id, Name FROM Users";
        return db.Query<User>(sqlQuery);
    }
}

```

### Пример 2: Добавление нового пользователя

```C#
using (IDbConnection db = new SqlConnection("Server=(localdb)\\mssqllocaldb;Database=MyDb;Trusted_Connection=True;"))
{
    string sqlInsert = "INSERT INTO Users (Name) VALUES (@Name)";
    int rowsAffected = db.Execute(sqlInsert, new { Name = "Ivan" });
}

```

### Пример 3: Получение одного пользователя по идентификатору

```C#
public User GetUserById(int id)
{
    using (IDbConnection db = new SqlConnection("Server=(localdb)\\mssqllocaldb;Database=MyDb;Trusted_Connection=True;"))
    {
        string sqlQuery = "SELECT Id, Name FROM Users WHERE Id = @Id";
        return db.QueryFirstOrDefault<User>(sqlQuery, new { Id = id });
    }
}

```

---

## Сравнение Dapper и EF Core

|Характеристика|Dapper|EF Core|
|---|---|---|
|**Тип ORM**|Микро-ORM, легковесная библиотека|Полноценный ORM с расширенными возможностями|
|**Отслеживание изменений**|Нет, разработчик сам отвечает за обновление данных|Да, `DbContext` автоматически отслеживает изменения|
|**Работа с миграциями**|Не поддерживает, схема базы управляется вручную|Встроенная поддержка миграций|
|**Скорость выполнения**|Очень высокая (близка к работе с чистым ADO.NET)|Чуть медленнее из-за дополнительных абстракций|
|**Уровень абстракции**|Низкий: прямой контроль над SQL-запросами|Высокий: LINQ, Fluent API, Data Annotations|
|**Гибкость запросов**|Полный контроль над SQL|Использование LINQ, но иногда требуется Raw SQL|
|**Удобство тестирования**|Зависимость от SQL, требует дополнительной абстракции|Более высокая абстракция, удобнее для юнит-тестирования|
|**Поддержка сложных сценариев**|Подходит для простых запросов, сложная логика должна быть реализована вручную|Множество встроенных функций для сложных запросов и моделей|

---

## Когда выбирать Dapper или EF Core?

- **Dapper:**
    
    - Если приоритетом является производительность и минимальное количество накладных расходов.
    - Когда необходимо выполнять сложные, оптимизированные SQL-запросы и не требуется отслеживание изменений.
    - Для микросервисов или небольших сервисов, где нужна быстрая обработка данных.
- **EF Core:**
    
    - Если требуется богатый функционал ORM, включая миграции, отслеживание изменений, LINQ-запросы и сложное управление состоянием объектов.
    - При разработке крупных приложений, где важна поддерживаемость, чистая архитектура и абстракция доступа к данным.
    - Если разработчику важно, чтобы большая часть логики работы с данными была реализована через декларативные средства (Data Annotations, Fluent API).

---

## Заключение

Dapper и EF Core решают схожие задачи, но подходят к ним с разных сторон. Dapper предоставляет прямой и быстрый доступ к данным за счёт минимальной абстракции, что делает его отличным выбором для высокопроизводительных сценариев. EF Core, в свою очередь, предлагает богатый набор возможностей, которые упрощают работу с объектами и базой данных за счёт автоматизации многих аспектов (отслеживание изменений, миграции, LINQ-запросы), что удобно для крупных и сложных приложений. Выбор между ними зависит от конкретных требований проекта: если нужна скорость и контроль — Dapper, если важна функциональность и удобство — EF Core.