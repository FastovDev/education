version: "3.5"
services:
	web-server: - имя любое для описания контейнера
		image: nginx:stable - версия образа
		container_name: mynginx  - имя контейнера
		volumes: - расположение и соотношение томов
			- '/opt/web/html:/var/www/html'
			- '/opt/web/pics:/var/www/pictures'
		environment: - добавляем переменные окружения
			- 'NGINX_HOST=web.romero.de'
			- 'NGINX_PORT=80'
		ports: - порты контейнера
			- '80:80'
			- '443:443'
		restart: unless-stopped  /always/no/on-failure
		command: --transaction-isolation=READ-COMMITED --binlog-format=ROW (взято из примера с базой данных - команда которая будет запущена при запуске контейнера)
		depends_on: - запуск контейнера после запуска других указанных в зависимости контейнеров 
		    - container_name
		 networks: 
			-appnet
			-internet
networks:
	appnet:
		driver: bridge
		name: webnet

volumes:
	nginx-config: - создание именных томов

docker-compose up (-d) - old run
docker compose up (-d) - new run

вместо image можно указывать build ., соберет образ из докерфайла

docker-compose logs -f
docker-compose stop
docker-compose down

Если не указывать сеть, то создается сеть с именем контейнера, web-server-default

#### 1. **Что такое Docker и Docker Compose?**

**Docker** — это открытая платформа для разработки, передачи и запуска приложений в контейнерах. Контейнеры позволяют разработчикам упаковка их приложений с необходимыми зависимостями, так что приложение может быть запущено в любой среде, где поддерживается Docker.

**Docker Compose** — это инструмент для определения и запуска многоконтейнерных Docker приложений. С помощью Compose можно описать конфигурацию сервисов, сетей и томов в одном файле, который будет использоваться для запуска всех необходимых контейнеров.

#### 2. **Зачем использовать Docker и Docker Compose?**

##### **Docker** используется для:

- **Изоляция приложения.** Каждый контейнер изолирует приложения и их зависимости, предоставляя более чистое и предсказуемое окружение.
- **Повторяемость.** Приложение будет работать одинаково в разных средах (локально, в облаке, на сервере) без зависимости от конфигурации хостовой системы.
- **Портативность.** Приложение в контейнере можно легко перенести между машинами, где установлен Docker.
- **Легкость в развертывании.** Приложения можно быстро разворачивать и масштабировать.
- **Микросервисная архитектура.** Легко изолировать и управлять различными частями приложения (например, базой данных, кэшом, API и т. д.).

##### **Docker Compose** используется для:

- **Оркестрация многоконтейнерных приложений.** Compose позволяет конфигурировать несколько сервисов, таких как веб-приложение, база данных и кэш, и запускать их с использованием единой конфигурации.
- **Упрощение развертывания.** Вместо того чтобы вручную запускать несколько контейнеров, Compose позволяет с помощью одной команды запустить сразу несколько контейнеров.
- **Управление сетями и томами.** Compose упрощает настройку сетевых соединений между контейнерами и управление томами данных.

#### 3. **Как применять Docker и Docker Compose?**

##### **Docker**:

- **Создание Docker-образа.** Образ Docker — это шаблон, содержащий все необходимые зависимости для приложения. Образ создается с помощью файла **Dockerfile**.
- **Запуск контейнеров.** Контейнер — это работающая версия образа. Он может быть запущен на любой машине, где установлен Docker.

##### **Docker Compose**:

- **Создание `docker-compose.yml`.** В этом файле описывается конфигурация всех контейнеров, которые будут запущены, а также их взаимодействие друг с другом (например, ссылки на базы данных или сети).

#### 4. **Особенности Docker и Docker Compose**

##### **Особенности Docker:**

- **Производительность.** Контейнеры гораздо легче виртуальных машин, так как они используют ядро хостовой операционной системы.
- **Легкость и скорость.** Контейнеры быстро запускаются и останавливаются. Это позволяет создавать и тестировать приложение быстро и эффективно.
- **Образование и хранение данных.** Docker позволяет использовать тома для хранения данных, обеспечивая их сохранность при пересоздании контейнеров.

##### **Особенности Docker Compose:**

- **Управление несколькими контейнерами.** Compose идеально подходит для работы с многосервисными приложениями, когда нужно одновременно запустить несколько сервисов.
- **Автоматизация.** С помощью Docker Compose можно автоматизировать запуск всех контейнеров и сервисов, что упрощает процесс развертывания.
- **Поддержка различных сетей.** Docker Compose позволяет легко настраивать взаимодействие между сервисами через отдельные сети.

#### 5. **Плюсы и минусы**

##### **Плюсы Docker и Docker Compose:**

- **Портативность:** Docker позволяет легко переносить приложения между различными средами.
- **Изоляция:** Приложения и их зависимости изолированы в контейнерах, что устраняет многие проблемы совместимости.
- **Масштабируемость:** Docker Compose помогает развертывать многосервисные приложения и масштабировать их.
- **Производительность:** Контейнеры запускаются быстрее, чем виртуальные машины.
- **Автоматизация:** Compose позволяет автоматизировать процессы развертывания и конфигурации сервисов.

##### **Минусы Docker и Docker Compose:**

- **Сложности с безопасностью.** При неправильной настройке контейнеры могут быть уязвимы к атакам, особенно если их конфигурации не защищены должным образом.
- **Производительность.** Контейнеры могут иметь меньшую производительность по сравнению с прямым использованием хостовой системы.
- **Необходимость в знании.** Для использования Docker и Docker Compose требуется понимание работы с контейнерами, что может быть непростым для новичков.
- **Управление состоянием.** В контейнерах может быть сложнее управлять состоянием, особенно в случае с базами данных, так как контейнеры могут быть пересозданы и удалены.

#### 6. **Пример использования Docker с C# и ASP.NET Core**

**Пример 1: Создание и запуск простого ASP.NET Core приложения в Docker**

1. Создаем **Dockerfile** для ASP.NET Core приложения.

```Dockerfile
# Используем официальный образ .NET SDK
FROM mcr.microsoft.com/dotnet/sdk:7.0 AS build

WORKDIR /app

# Копируем csproj и восстанавливаем зависимости
COPY *.csproj ./
RUN dotnet restore

# Копируем все файлы и строим приложение
COPY . ./
RUN dotnet publish -c Release -o out

# Запускаем приложение
FROM mcr.microsoft.com/dotnet/aspnet:7.0 AS base
WORKDIR /app
COPY --from=build /app/out ./

ENTRYPOINT ["dotnet", "MyApp.dll"]

```

2. Собираем образ и запускаем контейнер:

```sh
docker build -t myapp .
docker run -d -p 8080:80 myapp

```

Теперь приложение будет доступно на порту 8080 на вашей машине.

**Пример 2: Использование Docker Compose для многосервисного приложения**

Предположим, у нас есть ASP.NET Core приложение, которое взаимодействует с базой данных PostgreSQL.

1. **docker-compose.yml:**

```yaml
version: '3.4'

services:
  web:
    image: myapp
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:80"
    depends_on:
      - db

  db:
    image: postgres:13
    environment:
      POSTGRES_PASSWORD: example
    ports:
      - "5432:5432"
```
1. Теперь мы можем запускать оба сервиса одновременно с помощью Docker Compose:

```sh
docker-compose up --build

```

С помощью этого файла мы определили два сервиса:

- **web** — приложение ASP.NET Core.
- **db** — база данных PostgreSQL.

Compose автоматически настроит взаимодействие между ними (например, через сетевые соединения), и приложение будет доступно на порту 8080, а база данных на порту 5432.

#### 7. **Заключение**

Docker и Docker Compose — это мощные инструменты, которые позволяют эффективно развертывать и управлять приложениями. Они особенно полезны при разработке микросервисных архитектур, тестировании и обеспечении портативности приложений. Однако, несмотря на все плюсы, важно учитывать возможные проблемы с безопасностью, производительностью и необходимостью в обучении.